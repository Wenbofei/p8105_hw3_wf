P8105 HW3
================
Wenbo Fei
10/10/2020

\#Problem 1

``` r
data("instacart")
```

This dataset contains 1384617 rows and 15 columns. Each observation is
an item specific record. There are user / order variables – user ID,
order ID, order day, and order hour. There are also item variables –
name, aisle, department, and some numeric codes. For example, the first
order record shows that in order1 made by user112108 at 10:00 on the
forth day of a week after 9 days of his last purchase while this is his
4th order, a product “Bulgarian Yogurt” with ID 49302 is bought; this is
an reodered item and it was the first one to be added in his cart; it
belongs to dairy eggs department(16) on the yogurt aisle(120).

``` r
instacart %>% 
    count(aisle) %>% 
    arrange(desc(n))
```

    ## # A tibble: 134 x 2
    ##    aisle                              n
    ##    <chr>                          <int>
    ##  1 fresh vegetables              150609
    ##  2 fresh fruits                  150473
    ##  3 packaged vegetables fruits     78493
    ##  4 yogurt                         55240
    ##  5 packaged cheese                41699
    ##  6 water seltzer sparkling water  36617
    ##  7 milk                           32644
    ##  8 chips pretzels                 31269
    ##  9 soy lactosefree                26240
    ## 10 bread                          23635
    ## # … with 124 more rows

There are 134 aisles, and fresh vegetables are the most items ordered
from.

Let’s see the plot about number of items ordered in each aisle.

``` r
instacart %>% 
    count(aisle) %>% 
    filter(n > 10000) %>% 
    mutate(
        aisle = factor(aisle),
        aisle = fct_reorder(aisle, n)
    ) %>% 
    ggplot(aes(x = aisle, y = n)) + 
    geom_point() + 
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1)) +
  labs( y = "number of items ordered")
```

<img src="p8105_hw3_wf2270_files/figure-gfm/P1Q2-1.png" width="90%" />

Let’s see a table showing the three most popular items in each of the
aisles “baking ingredients”, “dog food care”, and “packaged vegetables
fruits”.

``` r
instacart %>% 
    filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
    group_by(aisle) %>% 
    count(product_name) %>% 
    mutate(rank = min_rank(desc(n))) %>% 
    filter(rank < 4) %>% 
    arrange(aisle, rank) %>% 
    knitr::kable()
```

| aisle                      | product\_name                                 |    n | rank |
| :------------------------- | :-------------------------------------------- | ---: | ---: |
| baking ingredients         | Light Brown Sugar                             |  499 |    1 |
| baking ingredients         | Pure Baking Soda                              |  387 |    2 |
| baking ingredients         | Cane Sugar                                    |  336 |    3 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats |   30 |    1 |
| dog food care              | Organix Chicken & Brown Rice Recipe           |   28 |    2 |
| dog food care              | Small Dog Biscuits                            |   26 |    3 |
| packaged vegetables fruits | Organic Baby Spinach                          | 9784 |    1 |
| packaged vegetables fruits | Organic Raspberries                           | 5546 |    2 |
| packaged vegetables fruits | Organic Blueberries                           | 4966 |    3 |

Let’s see a table showing the mean hour of the day at which Pink Lady
Apples and Coffee Ice Cream are ordered on each day of the week.

``` r
instacart %>% 
    filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
    group_by(product_name, order_dow) %>% 
    summarize(mean_hour = mean(order_hour_of_day)) %>% 
    pivot_wider(
        names_from = order_dow,
        values_from = mean_hour
    )
```

    ## `summarise()` regrouping output by 'product_name' (override with `.groups` argument)

    ## # A tibble: 2 x 8
    ## # Groups:   product_name [2]
    ##   product_name       `0`   `1`   `2`   `3`   `4`   `5`   `6`
    ##   <chr>            <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
    ## 1 Coffee Ice Cream  13.8  14.3  15.4  15.3  15.2  12.3  13.8
    ## 2 Pink Lady Apples  13.4  11.4  11.7  14.2  11.6  12.8  11.9

\#Problem 2

``` r
accel_data = 
  read_csv("./data/accel_data.csv") %>%
  janitor::clean_names() %>%
  pivot_longer(
    activity_1:activity_1440,
    names_to = "minute_of_day",
    names_prefix = "activity_",
    values_to = "activity_count" ) %>%
    mutate( weekend = ifelse(day %in% c("Saturday","Sunday"), 1, 0),
            day = forcats::fct_relevel(day, c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))) %>%
  mutate_at(vars(week:day_id), as.factor) %>%
  mutate_at("minute_of_day", as.integer) %>%
  mutate_at("weekend", as.logical) 
  
head(accel_data)
```

    ## # A tibble: 6 x 6
    ##   week  day_id day    minute_of_day activity_count weekend
    ##   <fct> <fct>  <fct>          <int>          <dbl> <lgl>  
    ## 1 1     1      Friday             1           88.4 FALSE  
    ## 2 1     1      Friday             2           82.2 FALSE  
    ## 3 1     1      Friday             3           64.4 FALSE  
    ## 4 1     1      Friday             4           70.0 FALSE  
    ## 5 1     1      Friday             5           75.0 FALSE  
    ## 6 1     1      Friday             6           66.3 FALSE

Our final dataset includes 50400 observations with 6 variables. Each
observation has a “week” variable indicating which week, a
unique“day\_id” variable for each specific day, a “day” variable
indicating the day of the week, a “minute\_of\_day” variable indicating
which minute of the day is the record about, a “activity\_court”
recoding the activity counts for the minute, and a “weekend” indicating
whether it’s a weekend or a weekday.

aggregate across minutes to create a total activity variable for each
day, and create a table showing these totals. Are any trends apparent?

``` r
accel_data %>%
  group_by(day_id) %>%
  summarize(total_activity = sum(activity_count)) %>%
  knitr::kable()
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

| day\_id | total\_activity |
| :------ | --------------: |
| 1       |       480542.62 |
| 2       |        78828.07 |
| 3       |       376254.00 |
| 4       |       631105.00 |
| 5       |       355923.64 |
| 6       |       307094.24 |
| 7       |       340115.01 |
| 8       |       568839.00 |
| 9       |       295431.00 |
| 10      |       607175.00 |
| 11      |       422018.00 |
| 12      |       474048.00 |
| 13      |       423245.00 |
| 14      |       440962.00 |
| 15      |       467420.00 |
| 16      |       685910.00 |
| 17      |       382928.00 |
| 18      |       467052.00 |
| 19      |       371230.00 |
| 20      |       381507.00 |
| 21      |       468869.00 |
| 22      |       154049.00 |
| 23      |       409450.00 |
| 24      |         1440.00 |
| 25      |       260617.00 |
| 26      |       340291.00 |
| 27      |       319568.00 |
| 28      |       434460.00 |
| 29      |       620860.00 |
| 30      |       389080.00 |
| 31      |         1440.00 |
| 32      |       138421.00 |
| 33      |       549658.00 |
| 34      |       367824.00 |
| 35      |       445366.00 |

I can’t see any apparent increasing or decreasing trend from this table.
Looks like except for 3 days, all the other days have same order of
magnitude of total activity count with fluctuation. We may need further
analysis and visulization to find systematic trend.

\#Problem 3
